name: Build and release uplink binaries
on:
  release:
    types: [published]

jobs:
  build-release-android:
    name: Build release for android
    runs-on: ubuntu-latest
    strategy:
      fail-fast: false
    steps:
      - uses: actions/checkout@v3
      - name: perms
        run: chown root:root .
      - run: sudo apt install unzip
      - run: cargo install cargo-ndk@2.11.0
      - name: Setup Android NDK
        id: ndk
        uses: nttld/setup-ndk@v1.2.0
        with:
          ndk-version: r23
      - run: rustup target add aarch64-linux-android

      - name: Build for aarch64
        run: cargo ndk --target aarch64-linux-android --platform 23 build --release --bin uplink

      - name: Rename uplink binaries
        run: |
          mv "target/aarch64-linux-android/release/uplink" "uplink-aarch64-linux-android"

      - name: Upload release archive
        uses: softprops/action-gh-release@v1
        with:
          files: uplink*
